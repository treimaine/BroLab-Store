ğŸ¯ OBJECTIF
Analyser entiÃ¨rement lâ€™application et remplacer TOUTE la persistance Neon/PostgreSQL directe par Supabase (Auth, DB, Storage) **sans casser lâ€™app**.  
Tu ne modifies rien tant que tu nâ€™as pas â‰¥95 % de certitude. Tu me proposes un plan, des diffs, tu attends ma validation Ã  chaque Ã©tape.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ§­ PROCESSUS IMPOSÃ‰ (par Ã©tapes, validation obligatoire)

### Ã‰TAPE 0 â€” Cartographie
1. Recherche dans tout le repo :
   - Mentions de Neon (URL, libs, drivers, migrations).
   - Clients PG (`pg`, `drizzle-orm`, `knex`, etc.).
   - Fichiers de config DB (`drizzle.config.ts`, `server/db.ts`, etc.).
   - Tests/mocks liÃ©s Ã  Neon ou au client PG.
2. Montre-moi un rÃ©sumÃ© clair :
   - OÃ¹ et comment la DB est initialisÃ©e.
   - Quels helpers/ORM utilisent Neon.
   - Quels env vars actuels (NEON_* ou DATABASE_URL).
   - OÃ¹ la logique dâ€™auth/stockage se trouve (si dÃ©jÃ  Supabase partielle).
3. Propose un PLAN DE MIGRATION minimal en 4 blocs :
   A) Remplacer lâ€™init BD par le client Supabase (service role) + helpers DB.  
   B) Adapter les helpers existants (CRUD) pour utiliser Supabase JS au lieu de requÃªtes SQL directes.  
   C) Mettre Ã  jour les tests + mocks (jest/vi) pour Supabase.  
   D) Nettoyer config Neon et dÃ©pendances inutiles.
4. STOP âœ Attends ma validation.

### Ã‰TAPE 1 â€” Configuration & Env
1. Lister les variables env nÃ©cessaires Ã  Supabase :
   - SUPABASE_URL
   - SUPABASE_ANON_KEY (pour le front si besoin)
   - SUPABASE_SERVICE_ROLE_KEY (pour le backend sÃ©curisÃ©)
   - SUPABASE_DB_URL (si tu utilises Supabase Postgres direct pour migrations/drizzle) â€” Ã  discuter
2. Proposer oÃ¹ les injecter (.env, .env.local).  
3. VÃ©rifier que les clÃ©s sont dÃ©jÃ  dispo ou me demander si besoin.  
4. STOP âœ validation.

### Ã‰TAPE 2 â€” Remplacer lâ€™init DB
1. CrÃ©er/Adapter un module `server/lib/supabaseAdmin.ts` :
   ```ts
   import { createClient } from '@supabase/supabase-js';
   export const supabaseAdmin = createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY, { auth: { persistSession: false } });
Dans server/lib/db.ts (ou Ã©quivalent), remplacer le code Neon/pg/drizzle par des helpers Supabase (select/insert/update).

Diff prÃ©cis (```diff) pour chaque fichier touchÃ©.

STOP âœ validation, puis applique et lance npm test.

Ã‰TAPE 3 â€” Helpers & RequÃªtes mÃ©tier
Pour chaque helper existant (getUserById, upsertSubscription, logDownload, createServiceOrder, etc.) :

VÃ©rifie quâ€™il appelle maintenant supabaseAdmin.from(...).select/insert/update.

Ajoute le typage (Types TS alignÃ©s avec nos interfaces existantes).

Proposer diffs par petits paquets (max 3â€“4 helpers Ã  la fois).

STOP âœ validation, appliquer, npm test.

Ã‰TAPE 4 â€” Tests & Mocks
Mocks Jest/Vi pour Supabase :

vi.mock('@supabase/supabase-js', ...) ou wrapper local mockÃ©.

Adapter les tests existants (neon-specific) pour passer via supabase mock.

Lancer toute la suite (npm test) et corriger minimalement jusquâ€™Ã  100 % vert.

STOP âœ validation.

Ã‰TAPE 5 â€” Nettoyage
Retirer :

Env vars Neon inutiles.

Fichiers de config (drizzle.config.ts) si plus utilisÃ©s.

DÃ©pendances PG inutiles (pg, neon, drizzle-orm si totalement remplacÃ©).

Proposer un diff package.json + removals.

STOP âœ validation, npm install, npm test, npm run dev.

Ã‰TAPE 6 â€” VÃ©rifications finales
DÃ©marrer en local : npm run dev â†’ pas dâ€™erreur DB.

Build si besoin : npm run build.

RÃ©sumÃ© final :

Fichiers modifiÃ©s

Env Ã  renseigner pour dev/prÃ©prod/prod

TODO (RLS, policies Supabase, migrations SQL Ã©ventuelles)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸ CONTRAINTES

Pas de refactor massif (>50 lignes/fichier) sans me demander.

Pas de nouvelle dÃ©pendance lourde sans proposer une alternative.

Typescript strict, pas dâ€™any gratuits.

Aucun appel rÃ©seau rÃ©el pendant les tests (Supabase mockÃ©).

Ne casse pas les lots dÃ©jÃ  validÃ©s (Aâ†’D & C port CLI).

âœ… SORTIE ATTENDUE

Diffs clairs, petits, validÃ©s avant application.

Tests 100 % verts.

App qui dÃ©marre en local avec Supabase.

Neon totalement retirÃ© ou isolÃ©.

Commence maintenant par lâ€™Ã‰TAPE 0 (cartographie + plan dÃ©taillÃ©). STOP avant dâ€™Ã©crire du code.
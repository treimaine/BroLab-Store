âš ï¸ RÃ¨gle gÃ©nÃ©rale
- Ne modifie rien tant que tu nâ€™as pas 95% de confiance sur la cause et la solution.
- Pose-moi une question dÃ¨s quâ€™un doute >5% subsiste ou si tu envisages un refactor structurel.
- Aucune suppression de logique mÃ©tier sans validation explicite.

ğŸ¯ Objectif
1. Faire passer tous les tests (`npm run test`) au vert.
2. Faire tourner lâ€™app localement sans crash (`npm run dev`).
3. Me fournir pour chaque correctif :
   - La liste des fichiers modifiÃ©s.
   - Le diff clair (ou un patch) de chaque fichier.
   - Un mini-changelog humain (â€œpourquoi / quoiâ€).
4. Ne rien casser : vÃ©rifier quâ€™aucun test prÃ©cÃ©demment vert ne devient rouge aprÃ¨s les fixes.

ğŸ›  Processus Ã  suivre (itÃ©ratif)
0. **Scan initial du repo** : note les points critiques (config Jest/TS, ESM/CJS, env, etc.).
1. **ExÃ©cute** :
   - `pnpm test --runInBand` (ou `npm test` selon le projet) et sauvegarde la sortie brute.
   - `pnpm run dev` (ou `npm run dev`) et rÃ©cupÃ¨re les erreurs runtime (stack traces complÃ¨tes).
2. **Regroupe les erreurs** par racine (typage, import manquant, session/cookie, mapping DB, ESM require/import, etc.).
3. **Pour chaque groupe dâ€™erreurs** :
   - Propose la correction la plus minimale et sÃ»re.
   - Applique-la.
   - Relance uniquement les tests concernÃ©s si possible (filtrage Jest), sinon toute la suite.
4. **VÃ©rifie le serveur dev** : relance `npm run dev`, assure-toi quâ€™il dÃ©marre et que les endpoints critiques rÃ©pondent (auth, woo, wp, etc.). Fournis logs si problÃ¨me.
5. **AprÃ¨s chaque batch** :
   - `git status` + `git diff --name-only` â†’ liste des fichiers modifiÃ©s.
   - `git diff` ciblÃ© sur les fichiers touchÃ©s (ou patch unifiÃ© si court).
   - RÃ©sumÃ© des changements (1-2 lignes par fichier).
6. RÃ©pÃ¨te jusquâ€™Ã  **0 test failing** et **`npm run dev` OK**.

ğŸ“ Branch & commits
- CrÃ©e une branche de travail : `fix/tests-dev-<date>` (format YYYYMMDD-HHMM).
- Un commit par bloc de corrections logique (ex: â€œfix: session cookie in testsâ€, â€œfix: TS types for BeatCardâ€).
- Ã€ la fin, propose-moi soit un squash, soit garder les commits sÃ©parÃ©s.

ğŸ” Contexte/contraintes spÃ©cifiques
- Node ESM : pas dâ€™utilisation de `require` sans wrapper ESM. PrÃ©fÃ¨re `import`.
- Supabase 100% : ne rÃ©introduis pas Neon/pg/drizzle sans validation.
- TS strict : corrige les typings proprement (pas de `any` sauvage sauf TODO commentÃ©).
- Ne touche pas aux secrets `.env`. Si besoin, mock ou paramÃ¨tre de test.
- Ne modifie pas le schÃ©ma DB sans validation.
- Les hooks WordPress/Woo sont maintenant cÃ´tÃ© serveur â†’ ne rÃ©introduis pas dâ€™appels directs cÃ´tÃ© client.
- Utilise les helpers centralisÃ©s dÃ©jÃ  crÃ©Ã©s (ex: `accessControl`, `db helpers`), ne duplique pas.

ğŸ“¦ Livrables finaux
- Liste finale des fichiers modifiÃ©s + diff global.
- Sortie complÃ¨te des tests (succÃ¨s).
- Confirmation que `npm run dev` dÃ©marre (port utilisÃ©, pas de crash).
- TODO restants (sâ€™il en existe), marquÃ©s P0/P1/P2.

â“Quand poser des questions
- Tu dÃ©tectes un conflit de logique mÃ©tier (ex: mapping Beat vs Product).
- Tu penses supprimer/refactorer un module complet.
- Tu veux changer la config Jest/TS/ESM profonde.
- Tu veux ajouter une dÃ©pendance externe.

Let's go. Commence par le scan & lâ€™exÃ©cution des commandes, renvoie-moi :
- Le log dâ€™erreurs brutes (tests + dev).
- Ta synthÃ¨se des groupes dâ€™erreurs.
- Ton plan de correction par batch (avec estimation de confiance).

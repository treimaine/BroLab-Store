ğŸ¯ OBJECTIF
Rendre lâ€™intÃ©gralitÃ© des scripts et configs de build/dev/test/start de lâ€™app compatibles Windows ET Linux (Replit, o2switch). Rien ne doit casser :
- Local Windows (PowerShell / Git Bash)
- Replit (Linux)
- PrÃ©prod & prod sur o2switch (Linux / cPanel + Node)

Tu dois :
1. Auditer tous les fichiers concernÃ©s (package.json, package.local.json, scripts *.sh/*.bat, tsconfig, vite, jest, dotenv, .replit, Procfile Ã©ventuel, scripts Node internes).
2. Identifier tous les points non cross-plateforme (rm -rf, cp, quotes, paths, exports dâ€™ENV, etc.).
3. Proposer un plan par micro-lots (â‰¤30 lignes/fichier) et demander validation si <95% de confiance.
4. Appliquer les corrections avec des outils cross-platform (cross-env, rimraf, shx/cpx ou scripts Node) OU un script Node unique (scripts/tasks/*) quand câ€™est plus propre.
5. VÃ©rifier aprÃ¨s chaque lot : `pnpm tsc --noEmit` + `pnpm test --runInBand`.
6. Lister prÃ©cisÃ©ment les fichiers modifiÃ©s et me donner un mini-changelog.

âš ï¸ RÃˆGLES
- Tu nâ€™appliques RIEN tant que tu nâ€™as pas prÃ©sentÃ© : audit + plan par lots + niveau de confiance.
- 95% de confiance minimum pour modifier. Sinon, pause + questions prÃ©cises (fichier/ligne).
- Aucune rÃ©gression : si un test casse, tu le rÃ©pares ou expliques pourquoi.
- Ne touche pas aux secrets. Ne modifie pas la logique mÃ©tier/DB.
- Respecte les prioritÃ©s P0/P1 du projet (stabilitÃ© build/dev/test > confort).

ğŸ§­ Ã‰TAPE 0 â€” AUDIT & CARTOGRAPHIE
Passe en revue :
- package.json / package.local.json (scripts : dev, build, start, test, lint, clean, etc.)
- .replit, .env*, vite.config*, jest.config*, tsconfig*, scripts shell/batch
- Fichiers custom (choosePort, dotenv loaders, etc.)
RepÃ¨re : `rm -rf`, `cp`, `export VAR=`, `NODE_ENV=xxx command`, chemins relatifs sensibles, extensions .sh/.bat, etc.

ğŸ’¼ Ã‰TAPE 1 â€” PLAN PAR LOTS
Structure le travail :
Lot 1 : Scripts npm/pnpm (clean, build, dev, start, test)
Lot 2 : Variables dâ€™environnement (cross-env, dotenv-flow/dotenvx dÃ©jÃ  prÃ©sent)
Lot 3 : Copies/cleanups (rimraf/shx/cpx ou node scripts)
Lot 4 : Config Replit & o2switch (PORT, start command)
Lot 5 : VÃ©rif Jest/TS/Vite sur Win/Linux
PrÃ©sente-moi ce plan avec niveau de confiance pour chaque lot.

ğŸ”§ Ã‰TAPE 2 â€” EXÃ‰CUTION PAR LOT
Pour chaque lot validÃ© :
1. Propose les diffs (â‰¤30 lignes/fichier). Exemple de corrections :
   - `"clean": "rimraf dist .tsbuild"` au lieu de `rm -rf`
   - `"build:server": "cross-env NODE_ENV=production tsx scripts/build-server.ts"`
   - `"dev": "cross-env NODE_ENV=development node scripts/dev.js"` (script Node qui lance vite + server)
   - scripts de copie via `shx cp` ou `cpx` si besoin
2. Applique, puis exÃ©cute :
   - `pnpm tsc --noEmit`
   - `pnpm test --runInBand`
3. Donne le rÃ©sultat + fichiers modifiÃ©s + mini-changelog + confiance.
4. Sâ€™il reste des warnings/edge cases Windows (quotes, paths), corrige-les.

ğŸ“‘ RAPPORT FORMAT
Ã€ CHAQUE LOT :
- âœ… RÃ©sumÃ© : ce qui est fixed
- ğŸ§ª RÃ©sultats `tsc` + `test`
- ğŸ—‚ Fichiers modifiÃ©s
- ğŸ“ Mini-changelog (1-2 lignes/fichier)
- ğŸ” TODO restants
- ğŸ¤” Questions (si <95% confiance)

ğŸ“Œ SPÃ‰CIFIQUE o2switch
- PrÃ©vois scripts `build:prod` et `start:prod` qui :
  - chargent `.env.production`
  - utilisent `cross-env` pour NODE_ENV
  - exportent PORT=5000 par dÃ©faut avec fallback choosePort
- Fournis un README_DEPLOY_O2SWITCH.md si besoin (commande ssh, pm2/passenger)

ğŸš« NE PAS FAIRE
- Revenir Ã  drizzle/neon
- Introduire de grosses libs sans me demander
- Casser la structure test/prod existante

âœ… FIN
- `pnpm tsc --noEmit` â†’ 0 erreurs
- `pnpm test` â†’ tous verts (ou expliquÃ©)
- Scripts npm fonctionnent Win+Linux
- Plan de dÃ©ploiement o2switch clair

â¡ï¸ COMMENCE
1. Audit complet & plan par lots â†’ attends ma validation
2. Puis exÃ©cute lot par lot comme dÃ©crit
